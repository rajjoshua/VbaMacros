import openpyxl

# load the workbook and select the worksheet
wb = openpyxl.load_workbook('input.xlsx')
ws = wb.active

# create a new workbook for the output
output_wb = openpyxl.Workbook()
output_ws = output_wb.active

# get user input for target step
target_step = input("Enter the target step: ")

# write headers to output worksheet
output_ws.cell(row=1, column=1, value="Step")
output_ws.cell(row=1, column=2, value="Role(s)")

# initialize variables
current_step = "Initiated"
current_row = 2

# loop through steps until target step is reached
while current_step != target_step:
    # get possible target steps for current step
    possible_targets = ws.cell(row=current_row, column=2).value.split(",")
    
    # loop through possible target steps
    for target in possible_targets:
        # check if target matches user input
        if target.strip() == target_step:
            # write current step and roles to output worksheet
            output_ws.cell(row=current_row, column=1, value=current_step)
            role_names = [ws.cell(row=1, column=j).value for j in range(3, ws.max_column+1) if ws.cell(row=current_row, column=j).value == "Yes"]
            output_ws.cell(row=current_row, column=2, value=", ".join(role_names))
            # update current step to target step
            current_step = target_step
            # exit loop
            break
    else:
        # if target step not found in possible targets, move to next row
        current_row += 1

# save the output workbook
output_wb.save('output.xlsx')
