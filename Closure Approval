Sub ExtractAndValidateApprovers()

    Dim OlMail As Outlook.MailItem
    Dim objAttachment As Outlook.Attachment
    Dim WordDoc As Object
    Dim WordApp As Object
    Dim tbl As Object, row As Object
    Dim ApproversInWord As String, EmailSender As String
    Dim EmbeddedMail As Outlook.MailItem
    Dim Lines() As String, Columns() As String
    Dim i As Integer

    On Error Resume Next
    Set OlMail = Application.ActiveExplorer.Selection.Item(1)

    ' Extract Approvers from Word Attachment
    If Not OlMail Is Nothing Then
        For Each objAttachment In OlMail.Attachments
            If Right(objAttachment.FileName, 4) = ".doc" Or Right(objAttachment.FileName, 5) = ".docx" Then
                ' Temporarily save the attachment
                objAttachment.SaveAsFile Environ("Temp") & "\" & objAttachment.FileName

                ' Open the Word document
                Set WordApp = GetObject(, "Word.Application")
                If WordApp Is Nothing Then Set WordApp = CreateObject("Word.Application")

                Set WordDoc = WordApp.Documents.Open(Environ("Temp") & "\" & objAttachment.FileName)
                WordApp.Visible = False

                If WordDoc.Tables.Count >= 3 Then
                    Set tbl = WordDoc.Tables(3)
                    For Each row In tbl.Rows
                        If row.Cells(5).Range.Text = "X" & vbCr Then
                            ApproversInWord = ApproversInWord & Trim(row.Cells(1).Range.Text) & vbNewLine
                        End If
                    Next row
                End If

                ' Close without saving
                WordDoc.Close wdDoNotSaveChanges
                ' Delete the temp file
                Kill Environ("Temp") & "\" & objAttachment.FileName
            End If
        Next objAttachment
    End If

    ' Assuming the email body represents the table row-by-row and columns are separated by tabs
    Lines = Split(OlMail.Body, vbNewLine)

    For i = LBound(Lines) To UBound(Lines)
        Columns = Split(Lines(i), vbTab) ' Assuming columns are separated by tabs
        
        If UBound(Columns) = 4 Then ' 5 columns, index 0 to 4
            ApproverInMail = Columns(0) ' First column for Approver Name

            For Each objAttachment In OlMail.Attachments
                If objAttachment.DisplayName = Columns(4) And objAttachment.Type = olEmbeddeditem Then ' Match attachment name with the fifth column
                    ' Save and Open the embedded email
                    objAttachment.SaveAsFile Environ("Temp") & "\embeddedMail.msg"
                    Set EmbeddedMail = Application.CreateItemFromTemplate(Environ("Temp") & "\embeddedMail.msg")

                    EmailSender = EmbeddedMail.SenderEmailAddress

                    ' Validate sender of the embedded email against Approver name in GRID and Word document
                    If InStr(ApproversInWord, ApproverInMail) > 0 And InStr(EmailSender, ApproverInMail) > 0 Then
                        MsgBox "Valid Approver: " & ApproverInMail & " with email: " & EmailSender
                    End If
                End If
            Next objAttachment
        End If
    Next i

    Set OlMail = Nothing
    Set objAttachment = Nothing
    Set EmbeddedMail = Nothing
    Set WordDoc = Nothing
    Set WordApp = Nothing

End Sub
